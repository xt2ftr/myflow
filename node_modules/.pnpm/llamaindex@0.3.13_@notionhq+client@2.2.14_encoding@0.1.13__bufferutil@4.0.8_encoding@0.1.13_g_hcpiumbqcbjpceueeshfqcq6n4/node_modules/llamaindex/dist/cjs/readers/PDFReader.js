"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PDFReader", {
    enumerable: true,
    get: function() {
        return PDFReader;
    }
});
const _env = require("@llamaindex/env");
const _Node = require("../Node.js");
class PDFReader {
    async loadData(file) {
        const content = await _env.fs.readFile(file);
        const pages = await readPDF(content);
        return pages.map((text, page)=>{
            const id_ = `${file}_${page + 1}`;
            const metadata = {
                page_number: page + 1
            };
            return new _Node.Document({
                text,
                id_,
                metadata
            });
        });
    }
}
async function readPDF(data) {
    const parser = await import("pdf2json").then(({ default: Pdfparser })=>new Pdfparser(null, 1));
    const text = await new Promise((resolve, reject)=>{
        parser.on("pdfParser_dataError", (error)=>{
            reject(error);
        });
        parser.on("pdfParser_dataReady", ()=>{
            resolve(parser.getRawTextContent());
        });
        parser.parseBuffer(data);
    });
    return text.split(/----------------Page \(\d+\) Break----------------/g);
}
