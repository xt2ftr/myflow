import { fs } from "@llamaindex/env";
import { Document } from "../Node.js";
/**
 * Read the text of a PDF
 */ export class PDFReader {
    async loadData(file) {
        const content = await fs.readFile(file);
        const pages = await readPDF(content);
        return pages.map((text, page)=>{
            const id_ = `${file}_${page + 1}`;
            const metadata = {
                page_number: page + 1
            };
            return new Document({
                text,
                id_,
                metadata
            });
        });
    }
}
async function readPDF(data) {
    const parser = await import("pdf2json").then(({ default: Pdfparser })=>new Pdfparser(null, 1));
    const text = await new Promise((resolve, reject)=>{
        parser.on("pdfParser_dataError", (error)=>{
            reject(error);
        });
        parser.on("pdfParser_dataReady", ()=>{
            resolve(parser.getRawTextContent());
        });
        parser.parseBuffer(data);
    });
    return text.split(/----------------Page \(\d+\) Break----------------/g);
}
